/*!
 * svg v1.0.0
 * Copyright 2017.12, Inc.
 * Producer chenglong
 */
(function(){var v=Snap("#svg");var u=document.querySelector(".action-show"),q=document.querySelector(".create-shape"),p=document.querySelector(".create"),n=document.querySelector(".face"),D=document.querySelector(".hengshu"),s=document.querySelector(".transform"),z=null,f=0,y=0,w=0,G=document.getElementById("translate-x"),F=document.getElementById("translate-y"),E=document.getElementById("scale"),B=document.getElementById("rotate"),o=50,C=5,r=10,k=30,t=1,l="text",j=0,e=0,c=0,h="http://www.w3.org/2000/svg",d={rect:"50, 50, 10, 30, 0",image:"200,200,50",line:"50,50,150,50",text:"50,50"},A={fill:"#fff",stroke:"#007fff"};var b=v.paper.path("M2,2 L2,8 L9,5 L2,2").attr({fill:"#000"});var a=b.marker(0,0,13,13,2,5);v.paper.click(function(I){if(I.target.tagName.toLowerCase() in d){document.getElementById("xz").innerHTML="";z=Snap(I.target);z.drag();var H=d[I.target.tagName].split(",");if(I.target.tagName=="line"){o=Snap(I.target).attr("x2");C=parseInt(Snap(I.target).attr("strokeWidth"))}else{if(I.target.tagName=="rect"){r=parseInt(Snap(I.target).attr("width"));k=parseInt(Snap(I.target).attr("height"))}else{if(I.target.tagName=="image"){r=parseInt(Snap(I.target).attr("width"));k=parseInt(Snap(I.target).attr("height"))}}}x(I.target.tagName,I.target.tagName,H);e=Snap(z).matrix.e;c=Snap(z).matrix.f}if(I.target.tagName.toLowerCase()=="image"){$(".ihide").hide()}else{$(".ihide").show()}});$(document).bind("keydown",function(I){if(I.which==46){if(z==""){alert("请选中图中元素");return n}var H=confirm("是否删除该元素");if(H==true){Snap(z).remove();z=""}else{}}});var i=new Clipboard("#fuzhi",{text:function(){return $(".action-show").html()}});i.on("success",function(H){alert("成功复制！")});i.on("error",function(H){alert("复制失败！")});$("#save").click(function(){window.localStorage.setItem("vhtml",$("#svg").html());alert("保存成功！")});$("#qingchu").click(function(){window.localStorage.removeItem("vhtml");alert("清除成功！")});$("#clear").click(function(){$("#svg").html("")});$(".selectChange").bind("change",function(H){if($(this).val()=="image"){$(".ihide").hide()}else{$(".ihide").show()}$(".changeName").attr({id:$(this).val(),sname:$(".selectChange").find("option:selected").attr("t"),})});p.addEventListener("click",g,false);function g(J){if(J.target.tagName.toLowerCase()==="button"){var H=J.target.id;var I=$(J.target).attr("sname");m(H,I)}}function m(K,J){var O=d[K].split(",");q.innerHTML="";var L,H,N;var M="img/"+J+".svg";if(K=="line"){z=v.paper.line(O[0],O[1],O[2],O[3]).attr({stroke:"#000",strokeWidth:5,}).drag()}else{if(K=="rect"){z=v.paper.rect(O[0],O[1],O[2],O[3],O[4]).attr({fill:"#f00"}).drag()}else{if(K=="text"){var I='"'+(new Date().getTime())+'"';var P="D"+I.substring(8,13);j=j+1;z=v.paper.text(O[0],O[1],l).attr({dataid:P,id:"text"+j}).drag()}else{if(K=="image"){z=v.paper.image(M,10,10,80,80).drag()}}}}N=O;x(K,K,N)}function x(H,I,K){var J=document.createElement("div");if(H=="line"){J.innerHTML='<button type="button" class="hengshu">横竖转换</button><button type="button" class="jiantou">加箭头</button><label>长 <input type="range" min="1" max="800" value="'+o+'" name="chang" /><span class="changS">'+o+'</span></label><label>宽 <input type="range" min="1" max="50" value="'+C+'" name="kuan" /><span class="kuanS">'+C+"</span></label>"}else{if(H=="rect"){J.innerHTML='<label>宽 <input type="range" min="1" max="500" value="'+r+'" name="chang" /></label><label>高 <input type="range" min="1" max="500" value="'+k+'" name="kuan" /></label>'}else{if(H=="image"){J.innerHTML='<label>大小 <input type="range" min="1" max="200" value="'+r+'" name="chang" /></label><label>旋转 <input type="range" min="1" max="4" value="'+t+'" name="kuan" /></label>'}else{if(H=="text"){J.innerHTML='<label>大小 <input type="range" min="1" max="200" value="'+r+'" name="chang" /></label><label>文字 <input type="text" maxlength="30" value="'+l+'" name="kuan" /></label>'}}}}q.appendChild(J)}$("#zindex_1").click(function(){var H=document.getElementById("svg").lastChild;Snap(H).after(Snap(z))});$("#zindex_2").click(function(){var H=document.getElementById("svg").firstElementChild;Snap(H).before(Snap(z))});q.addEventListener("input",function(H){if(H.target.tagName.toLowerCase()==="input"){if(z.type=="line"){if(H.target.name=="chang"){$(".changS").text(parseInt(H.target.value)+50);Snap(z).attr({x2:parseInt(H.target.value)+50,})}else{if(H.target.name=="kuan"){$(".kuanS").text(parseInt(H.target.value));Snap(z).attr({strokeWidth:parseInt(H.target.value),})}}}else{if(z.type=="rect"){if(H.target.name=="chang"){Snap(z).attr({width:parseInt(H.target.value),})}else{if(H.target.name=="kuan"){Snap(z).attr({height:parseInt(H.target.value),})}}}else{if(z.type=="text"){if(H.target.name=="chang"){Snap(z).attr({fontSize:parseInt(H.target.value),})}else{if(H.target.name=="kuan"){Snap(z).attr({text:H.target.value,})}}}else{if(z.type=="image"){if(H.target.name=="chang"){Snap(z).attr({width:parseInt(H.target.value),height:parseInt(H.target.value)})}else{if(H.target.name=="kuan"){var I=0;if(H.target.value>1&&H.target.value<=2){I=90}else{if(H.target.value>2&&H.target.value<=3){I=180}else{if(H.target.value>3&&H.target.value<=4){I=270}else{I=360}}}Snap(z).transform(new Snap.Matrix().translate(e,c).rotate(I,Snap(z).attr("width")/2,Snap(z).attr("height")/2))}}}}}}}},false);$(document).on("click",".hengshu",function(H){if($(this).attr("t")==1){Snap(z).transform(new Snap.Matrix().translate(e,c).rotate(0,50,50));$(this).removeAttr("t")}else{$(this).attr("t","1");Snap(z).transform(new Snap.Matrix().translate(e,c).rotate(90,50,50))}});$(document).on("click",".jiantou",function(H){Snap(z).attr({"marker-end":a})});n.addEventListener("input",function(H){if(!z){alert("请先创建图形");return}if(H.target.tagName.toLowerCase()==="input"){var I=H.target.id;switch(I){case"fill":Snap(z).attr({fill:H.target.value,});break;case"stroke":Snap(z).attr({stroke:H.target.value,});break;case"stroke-width":Snap(z).attr({strokeWidth:H.target.value,});break}}},false);$(document).ready(function(){if(window.localStorage.getItem("vhtml")!=null){$("#svg").html(window.localStorage.getItem("vhtml"))}})})();